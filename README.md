# stm32f3disco-debounce
Two sided LED switch circuit with hardware debouncing provided for SPST pushbutton external to the computer board.  

This repository and the attached documentation is for reference.  
My math may be wrong. Check it yourself.  

## Schematic
Schematic was created using [Circuit-Diagram](https://www.circuit-diagram.org) free circuit diagram drawing tool.
![alt text](https://github.com/kkeian/stm32f3disco-debounce/blob/main/images/schematic.png)

Schematic drawing was model almost exactly off of the schematic for SPST switch in this great article on [hardware debounce](https://www.digikey.com/en/articles/how-to-implement-hardware-debounce-for-switches-and-relays) at DigiKey written by Clive "Max" Maxfield.

## The Circuit Components
![alt text](https://github.com/kkeian/stm32f3disco-debounce/blob/main/images/components.JPG)
The embedded board is an STM32F3-Discovery board.

### Voltage, Current, Resistors, and Capacitance Values
$V_{DD} = 2.84$ $V$ Voltage from Pin PA1  
$I_{DD} = 74.3$ $\mu A$ Current from Pin PA1  
$R_{ext} = 220$ $\Omega$ - the resistor external to the PCB  
$R_{int}$ - the pullup-pulldown resistor internal to the PCB  
$C = 100$ $\mu F$ - capacitor  
  
<ins>Capacitor Charge Time</ins>:  
$R_{int} = \frac{V_{DD}}{I_{DD}} = \frac{2.84}{\frac{74.3}{1000000}}$  
$R_{int} = \frac{2.84 \cdot 1000000}{74.3} \approx 38,223$ $\Omega$  
$T = R \cdot C = R_{int} \cdot C = 38.2$ $k \Omega$ $\cdot 100$ $\mu F \approx 3.82$ sec - time constant  
$5 \cdot T \approx 5 \cdot 3.82 \approx 19$ sec - time until capacitor is fully charged/discharged  
  
<ins>Capacitor Discharge Time</ins>:  
$T = R \cdot C = R_{int} \cdot C = 220$ $\Omega$ $\cdot 100$ $\mu F \approx 0.022$ sec $\approx 22$ ms - time constant  
$5 \cdot T \approx 5 \cdot 0.022 \approx 0.11$ sec $\approx 110$ ms - time until capacitor is fully charged/discharged  
  
We want a debounce time of 100 - 200 ms so this is a good resistor-capacitor value combination. 

## The Assembled Circuit
<img src="https://github.com/kkeian/stm32f3disco-debounce/blob/main/images/connections0.JPG" height="300" width="400"/>
<img src="https://github.com/kkeian/stm32f3disco-debounce/blob/main/images/connections1.JPG" height="300" width="400"/>
<img src="https://github.com/kkeian/stm32f3disco-debounce/blob/main/images/connections2.JPG" height="300" width="400"/>

Firmware uses:
- an internal pull-down resistor for the blue USER button on the PCB.
- an internal pull-up resistor for Pin 1 on GPIO A (PA1 GPIO pin header).

## Demo
[![](https://img.youtube.com/vi/t1ZHl23sQMs/0.jpg)](https://www.youtube.com/watch?v=t1ZHl23sQMs)

## Source Files
- interrupts.ioc - STM32CubeIDE generated file with configuration parameters for the STM32F3-Disco board
- main.c - part of the code generated by STM32CubeIDE with the `HAL_GPIO_EXTI_Callback` implemented by hand.  
NOTE: The interrupts.ioc may or may not be sufficient to import into the STM32CubeIDE to view the project configuration.  
You will likely need to use the `\.[.*]project` files when importing the code files above.  
The STM32CubeIDE also generates quite a lot of other boilerplate code for the STM HAL functions. Without that boilerplate code, the project won't build regardless.  
Keep this in mind if you are trying to replicate what is in this repo on your own board.  
